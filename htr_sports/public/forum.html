<!DOCTYPE html>
<html lang="en">
<head>
  <title>HTR Sports Forum</title>
</head>
<body>
<h1><center>Welcome!</center></h1>
<center><div class = "dropdown">
    <div class = "dropdown-content">
      <form>
        <label for = "title">Title:</label>
        <input type = "text" id = "title" name = "title"><br><br>
        <label for = "body">Body:</label>
        <input type = "text" id = "body" name = "body"><br><br>
        <input type = "button" id = "insert" value = "Submit Post"> <!-- onclick = "createAccount()" -->
      </form>
    </div>
  </div></center>
</body>
<h2>Latest Posts</h2>
<body>
  <dl id = "forum">

  </dl>
</body>

<script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.9.4/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.9.4/firebase-analytics.js";
    import {getDatabase, set, get, update, remove, ref, child, push, onValue, query} from "https://www.gstatic.com/firebasejs/9.9.4/firebase-database.js";
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries

    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
      apiKey: "AIzaSyBoF3DW_pIDocCRPlrqFpUfxdXtCT7lpFQ",
      authDomain: "htr-sports.firebaseapp.com",
      databaseURL: "https://htr-sports-default-rtdb.firebaseio.com",
      projectId: "htr-sports",
      storageBucket: "htr-sports.appspot.com",
      messagingSenderId: "119767757957",
      appId: "1:119767757957:web:d9f4cfeed391dc8bbde5ec",
      measurementId: "G-WEB0Z72L02"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);

    const db = getDatabase();

    var user = document.getElementById("username");
    var title = document.getElementById("title");
    var body = document.getElementById("body");
    var insertBTN = document.getElementById("insert");
    var forum = document.getElementById("forum");
    var insertBTNedit = document.getElementById("edit");

    function CreatePost(){
      //alert("Clicked");
      push(ref(db, '/Posts'),{
         Title: title.value,
         Body: body.value
     })
     .then(()=>{
         alert("Posted successfully");
         location.reload();
     })
     .catch((error)=>{
         alert(error);
     });
    }

    insertBTN.addEventListener('click',CreatePost);

    async function readData(){
        const dbRef = ref(db);
        get(child(dbRef, `Posts/`)).then((snapshot) => {
        if (snapshot.exists()) {
            //console.log(snapshot.val());
            for (var key in snapshot.val()){
              console.log(snapshot.val()[key]);
              const title = document.createElement("dt");
              title.innerHTML = "Post: "+snapshot.val()[key].Title;
              const post = document.createElement("dd");
              post.innerHTML = snapshot.val()[key].Body;
              const linebreaker = document.createElement("dt")
              linebreaker.innerHTML = "---------------------------------------------"
              forum.appendChild(title);
              forum.appendChild(post);
              //forum.insertBTNedit.addEventListener('click',editPost);
              const edit = document.createElement("e");
              edit.innerHTML = edit.innerHTML + "<br>Title: <input type='text' id='title' /><br>Body: <input type='text' id='body'/><br><button type='button' onclick=editPost() >Edit</button><br>";
              forum.appendChild(edit); 
              forum.appendChild(linebreaker);
            }
        } else {
        console.log("No data available");
    }
        }).catch((error) => {
        console.error(error);
        });
    }
    readData();

    function editPost(){
      set(ref(db, '/Posts'),{
         Title: title.value,
         Body: body.value
     })
     .then(()=>{
         alert("Edited successfully");
         location.reload();
     })
     .catch((error)=>{
         alert(error);
     });
    }
  </script>
</html>